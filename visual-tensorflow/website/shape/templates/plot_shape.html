<!doctype html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Plot Shape</title>
    <script src="/static/jslibs/jquery.min.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <!-- <link rel="stylesheet" href="css/styles.css?v=1.0"> -->
</head>

<body>
    <div id="plot"></div>
    <div style="max-width:800px; max-height:400px">
        <canvas id="chart" width="800" height="400"></canvas>
    </div>
    <div style="padding-left:222px;padding-top:50px" id="frame"></div>
    <script type="text/javascript" src="../static/js/dat.gui.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.bundle.js"></script>
    <script type="text/javascript">
        var data = {{ data|safe }};     // load data from Flask using Jinja
      
        var FizzyText = function() {
            this.message = 'dat.gui';
            this.windowSize = 48;
            var _this = this;

            function render() {
                var fieldNameElement = document.getElementById("plot");
                fieldNameElement.innerHTML = "Water" + _this.windowSize;

                // Get preds
                // $.ajax({
                //   url: '/api/pred/' + _this.windowSize,
                //   type: 'GET',
                //   success: function(data) {
                //     // console.log(data);
                //   },
                //   error: function(xhr, status, err) {
                //     // console.log(err);
                //   }
                // });
            }

            function loop() {
                requestAnimationFrame(loop);
                render();
            }

            loop();
        };

        window.onload = function() {
            var text = new FizzyText();
            var gui = new dat.GUI();
            gui.add(text, 'windowSize').min(1).max(100).step(1);
        };
    </script>

    <script>
        var data2smoothed = [];
        for (var i =0; i < data.smoothed.length; i++) {
            data2smoothed.push(data.smoothed[i] * 0.5);
        }

        function formatSeconds(seconds) {
              var date = new Date(null);
              date.setSeconds(seconds); // specify value for SECONDS here
              return date.toISOString().substr(11, 8);
        }

        // Each label is the timestamp hr:min:sec in the video
        function getLabels(data) {
            var numSec = data.length;
            var labels = [];
            for (var i = 0; i < numSec; i++) {
              labels.push(formatSeconds(i));
            }
            return labels;
        }

        var labels = getLabels(data.smoothed);

        var chartData = {
            labels: labels,
            datasets: [
                {
                    label: "My First dataset",
                    // backgroundColor: [
                    //     'rgba(255, 99, 132, 0.2)',
                    //     'rgba(54, 162, 235, 0.2)',
                    //     'rgba(255, 206, 86, 0.2)',
                    //     'rgba(75, 192, 192, 0.2)',
                    //     'rgba(153, 102, 255, 0.2)',
                    //     'rgba(255, 159, 64, 0.2)'
                    // ],
                    // borderColor: [
                    //     'rgba(255,99,132,1.0)',
                    //     'rgba(54, 162, 235, 1.0)',
                    //     'rgba(255, 206, 86, 1.0)',
                    //     'rgba(75, 192, 192, 1.0)',
                    //     'rgba(153, 102, 255, 1.0)',
                    //     'rgba(255, 159, 64, 1.0)'
                    // ],
                    borderWidth: 0.1,
                    data: data.smoothed,
                },
                {
                    label: "Number two",
                    borderWidth: 0.1,
                    data: data2smoothed
                }
            ],
        };

        var options = {
            global: {
                responsive: true,
                maintainAspectRatio: false
            },
            elements: {   // Don't show individual points on line graph
                point:{
                    radius: 0
                }
            },
            tooltips: {     // tooltip for points on current mouse x-axis position
                mode: 'index',
                intersect: false
            },
            scales: {
                xAxes: [{
                    ticks: {
                      autoSkipPadding: 50
                    }
                }],
                // yAxes: [{   // Y-axis from 0 to 1
                //     ticks: {
                //         min: 0.0,
                //         max: 1.0
                //     }
                // }],
            },
            hover: {
                onHover: function (e) {
                    if (e[0]) {
                        show_image("../static/videos/" + data.frames[e[0]._index], 256, 256, '');
                    }
                },
                mode: 'index',
                intersect: false
            },
        };

        function show_image(src, width, height, alt) {
            var frameElement = document.getElementById("frame");
            if (frameElement.firstChild) {      // if element already exists
                frameElement.firstChild.src = src;
            } else {                            // make element and append to DOM
                var img = document.createElement("img");
                img.src = src;
                img.width = width;
                img.height = height;
                img.alt = alt;
                frameElement.appendChild(img);
            }
        }
        show_image("../static/videos/" + data.frames[0], 256, 256, '');

        var ctx = $("#chart");
        var myLineChart = new Chart(ctx, {
            type: 'line',
            data: chartData,
            options: options,
        });
    </script>
</body>
</html>